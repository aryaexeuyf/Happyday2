<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAPPY DAY Season 2</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #ff0000;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            position: relative;
        }

        /* Fullscreen & Landscape */
        html, body {
            height: 100%;
            width: 100%;
        }

        @media screen and (orientation: portrait) {
            body::before {
                content: "PUTAR HP ANDA KE MODE LANDSCAPE";
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 24px;
                color: red;
                z-index: 9999;
                background: black;
                padding: 20px;
                border: 2px solid red;
            }
        }

        /* Glitch Effect */
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .glitch {
            animation: glitch 0.3s infinite;
        }

        /* TV Static Effect */
        .tv-static {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.1;
            z-index: 1000;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(255, 255, 255, 0.03) 2px,
                rgba(255, 255, 255, 0.03) 4px
            );
        }

        /* Pages */
        .page {
            display: none;
            height: 100vh;
            width: 100vw;
            position: relative;
            background: radial-gradient(circle at center, #1a0000 0%, #000 100%);
        }

        .page.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Title Screen */
        .title-screen h1 {
            font-size: 5rem;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 0 0 20px #ff0000;
            letter-spacing: 5px;
        }

        .subtitle {
            font-size: 1.5rem;
            color: #800000;
            margin-bottom: 50px;
            animation: flicker 2s infinite;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .start-btn {
            padding: 20px 60px;
            font-size: 2rem;
            background: #8B0000;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 3px;
            position: relative;
            overflow: hidden;
        }

        .start-btn:hover {
            background: #ff0000;
            box-shadow: 0 0 30px #ff0000;
            transform: scale(1.1);
        }

        /* Level Selection */
        .level-grid {
            display: flex;
            gap: 50px;
            margin-top: 50px;
        }

        .level-card {
            width: 200px;
            height: 250px;
            background: #1a1a1a;
            border: 3px solid #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .level-card.available:hover {
            border-color: #ff0000;
            box-shadow: 0 0 20px #ff0000;
            transform: scale(1.05);
        }

        .level-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .lock-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 30px;
            color: #666;
        }

        .delete-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }

        .delete-btn:hover {
            color: #ff0000;
        }

        /* Story Text Animation */
        .story-text {
            font-size: 1.2rem;
            line-height: 1.8;
            max-width: 80%;
            text-align: center;
            opacity: 0;
            animation: typewriter 3s forwards;
        }

        @keyframes typewriter {
            to { opacity: 1; }
        }

        /* Name Input */
        .name-input-container {
            margin-top: 50px;
            text-align: center;
        }

        .name-input {
            padding: 15px 30px;
            font-size: 1.5rem;
            background: #1a1a1a;
            border: 2px solid #ff0000;
            color: white;
            text-align: center;
            margin: 10px;
        }

        .name-suggestions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .name-tag {
            padding: 10px 20px;
            background: #333;
            border: 1px solid #666;
            cursor: pointer;
            transition: all 0.3s;
        }

        .name-tag:hover {
            background: #ff0000;
            border-color: #ff0000;
        }

        /* Spin Animation */
        .spin-container {
            width: 300px;
            height: 300px;
            position: relative;
            margin: 50px auto;
        }

        .spin-item {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            opacity: 0;
            animation: spin 3s ease-in-out;
        }

        @keyframes spin {
            0% { transform: rotate(0deg) scale(0); opacity: 1; }
            50% { transform: rotate(180deg) scale(1.5); }
            100% { transform: rotate(360deg) scale(0); opacity: 0; }
        }

        /* Alert Page */
        .alert-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .alert-container.active {
            display: flex;
        }

        .alert-text {
            font-size: 2rem;
            color: #ff0000;
            text-align: center;
            animation: blink 0.5s infinite;
            margin-bottom: 30px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .video-container {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 300px;
            height: 200px;
            overflow: hidden;
            border: 3px solid #ff0000;
            filter: contrast(1.5) brightness(0.8) saturate(1.5) hue-rotate(10deg);
        }

        .video-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 1px,
                rgba(255, 0, 0, 0.1) 1px,
                rgba(255, 0, 0, 0.1) 2px
            );
            z-index: 1;
            pointer-events: none;
        }

        .countdown {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1rem;
            color: #ff0000;
            opacity: 0.3;
        }

        /* Hidden camera flash */
        .camera-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 10000;
        }

        @keyframes flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 0.5; }
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: #ff0000;
        }

        .loading.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="tv-static"></div>
    <div class="camera-flash" id="cameraFlash"></div>

    <!-- Background Audio -->
    <iframe id="bgMusic" width="1" height="1" 
        src="https://www.youtube.com/embed/lVBBIkA7tMI?autoplay=1&loop=1&playlist=lVBBIkA7tMI" 
        frameborder="0" allow="autoplay; encrypted-media" style="display: none;">
    </iframe>

    <!-- Page 1: Start Screen -->
    <div class="page active" id="page1">
        <div class="title-screen">
            <h1 class="glitch">HAPPY DAY</h1>
            <div class="subtitle">SEASON 2</div>
            <button class="start-btn" onclick="startGame()">START GAME</button>
        </div>
    </div>

    <!-- Page 2: Level Selection -->
    <div class="page" id="page2">
        <h2 style="font-size: 3rem; margin-bottom: 30px;">PILIH LEVEL</h2>
        <button class="delete-btn" onclick="deleteProgress()">🗑️</button>
        <div class="level-grid">
            <div class="level-card available" onclick="selectLevel(1)">
                <h3>LEVEL 1</h3>
                <p>Malam Pertama</p>
            </div>
            <div class="level-card locked">
                <span class="lock-icon">🔒</span>
                <h3>LEVEL 2</h3>
                <p>Dalam Pengembangan</p>
            </div>
            <div class="level-card locked">
                <span class="lock-icon">🔒</span>
                <h3>LEVEL 3</h3>
                <p>Dalam Pengembangan</p>
            </div>
        </div>
    </div>

    <!-- Page 3: Story & Name Input -->
    <div class="page" id="page3">
        <div class="story-text" id="storyText"></div>
        <div class="name-input-container" id="nameInputContainer" style="display: none;">
            <input type="text" class="name-input" id="nameInput" placeholder="Masukkan nama Anda">
            <button class="start-btn" onclick="saveName()">SETUJU & LANJUT</button>
            <div class="name-suggestions">
                <div class="name-tag" onclick="selectName('Reyvan')">Reyvan</div>
                <div class="name-tag" onclick="selectName('Balqis')">Balqis</div>
                <div class="name-tag" onclick="selectName('Saka')">Saka</div>
                <div class="name-tag" onclick="selectName('Carol')">Carol</div>
            </div>
        </div>
    </div>

    <!-- Page 4: Mission 1 - Spin Name -->
    <div class="page" id="page4">
        <div class="story-text" id="mission1Text"></div>
        <div class="spin-container" id="spinContainer"></div>
        <button class="start-btn" id="continueBtn1" style="display: none;" onclick="nextMission(2)">LANJUT MISI 2</button>
    </div>

    <!-- Page 5: Mission 2 - Find Clue -->
    <div class="page" id="page5">
        <div class="story-text" id="mission2Text"></div>
        <input type="text" class="name-input" id="clueInput" placeholder="Masukkan kata kunci">
        <button class="start-btn" onclick="checkClue()">SUBMIT</button>
        <div id="clueResult"></div>
    </div>

    <!-- Page 6: Mission 3 - Step Back -->
    <div class="page" id="page6">
        <div class="story-text" id="mission3Text"></div>
        <div class="spin-container" id="stepBackContainer"></div>
        <button class="start-btn" id="continueBtn3" style="display: none;" onclick="nextMission(4)">LANJUT MISI 4</button>
    </div>

    <!-- Page 7: Mission 4 - Circle School -->
    <div class="page" id="page7">
        <div class="story-text" id="mission4Text"></div>
        <button class="start-btn" onclick="nextMission(5)">LANJUT MISI 5</button>
    </div>

    <!-- Page 8: Mission 5 - Final Mission -->
    <div class="page" id="page8">
        <div class="story-text" id="mission5Text"></div>
        <button class="start-btn" onclick="completeGame()">SELESAIKAN MISI</button>
    </div>

    <!-- Alert Container -->
    <div class="alert-container" id="alertContainer">
        <div class="alert-text" id="alertText"></div>
        <div class="video-container">
            <iframe id="alertVideo" width="100%" height="100%" 
                src="" frameborder="0" 
                allow="autoplay; encrypted-media">
            </iframe>
        </div>
    </div>

    <!-- Countdown -->
    <div class="countdown" id="countdown"></div>

    <!-- Loading -->
    <div class="loading" id="loading">Loading...</div>

    <script src="app.js"></script>
    <script>
        // Request permissions on load
        window.onload = function() {
            requestPermissions();
            checkTime();
            setInterval(checkTime, 60000); // Check every minute
            setInterval(updateCountdown, 1000); // Update countdown every second
        };

        function requestPermissions() {
            // Request camera permission
            navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                .then(function(stream) {
                    console.log('Permissions granted');
                })
                .catch(function(err) {
                    console.log('Permissions denied');
                });

            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function startGame() {
            playSound('https://youtu.be/d40PeoOXE1E?si=kuMBVr91bBEFG6i-');
            showPage(2);
        }

        function showPage(pageNum) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(`page${pageNum}`).classList.add('active');
            
            // Save progress
            localStorage.setItem('currentPage', pageNum);
        }

        function selectLevel(level) {
            if (level === 1) {
                showPage(3);
                showStory();
            } else {
                alert('Level game ini sedang dalam pengembangan (HAPPYDAY Present)');
            }
        }

        function showStory() {
            const story = `Hallo saya orang di belakang Anda yang bener-bener GK keliatan secara wujud tapi saya telah memantau anda setelah anda membuka link website ini dan setuju-semua syarat yang kami berikan sebelum nya berarti anda telah tau konsekuensi nya yaitu anda harus menerima semua teror yang saya berikan di kawasan sini, anda pasti berada di lokasi : Dekat GFX5+PCW TOKO HARIYANTO, Unnamed Road, Jatikulon, Lengkong, Kec. Mojoanyar, Kabupaten Mojokerto, Jawa Timur 61364, anda di sebelah pojok kiri toko Hariyanto jalan njatikulon, dan orang-orang di dekat anda pasti anak-anak kecil`;
            
            typeWriter(story, 'storyText', () => {
                document.getElementById('nameInputContainer').style.display = 'block';
            });
        }

        function typeWriter(text, elementId, callback) {
            const element = document.getElementById(elementId);
            element.textContent = '';
            let i = 0;
            
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, 50);
                } else if (callback) {
                    callback();
                }
            }
            type();
        }

        function selectName(name) {
            document.getElementById('nameInput').value = name;
        }

        function saveName() {
            const name = document.getElementById('nameInput').value;
            if (name) {
                let players = JSON.parse(localStorage.getItem('players') || '[]');
                players.push(name);
                localStorage.setItem('players', JSON.stringify(players));
                localStorage.setItem('currentPlayer', name);
                showPage(4);
                startMission1();
            }
        }

        function startMission1() {
            const text = `Berikutnya kami akan memilih ketua dari anggota yang telah mendaftar...`;
            typeWriter(text, 'mission1Text', () => {
                spinNames();
            });
        }

        function spinNames() {
            const players = JSON.parse(localStorage.getItem('players') || '[]');
            const container = document.getElementById('spinContainer');
            container.innerHTML = '';
            
            let spinCount = 0;
            const maxSpins = 10;
            
            const spinInterval = setInterval(() => {
                const randomPlayer = players[Math.floor(Math.random() * players.length)];
                container.innerHTML = `<div class="spin-item">${randomPlayer}</div>`;
                
                spinCount++;
                if (spinCount >= maxSpins) {
                    clearInterval(spinInterval);
                    const finalPlayer = players[Math.floor(Math.random() * players.length)];
                    container.innerHTML = `<div class="spin-item" style="animation: none; opacity: 1; transform: scale(1.5);">${finalPlayer}</div>`;
                    localStorage.setItem('ketua', finalPlayer);
                    
                    setTimeout(() => {
                        const resultText = `Nama yang akan kami pilih menjadi ketua di game horor ini adalah ${finalPlayer}, berikutnya akan menjalankan misi...`;
                        typeWriter(resultText, 'mission1Text', () => {
                            document.getElementById('continueBtn1').style.display = 'block';
                        });
                    }, 1000);
                }
            }, 300);
        }

        function nextMission(missionNum) {
            showPage(4 + missionNum - 1);
            
            if (missionNum === 2) {
                const text = `Kalian harus mencari petunjuk text di sebelah SD mi swasta yang kami pilih menjadikan suatu misi untuk mencari kata kunci untuk menamatkan game horor ini, yaitu kalian harus mencari kertas di masing-masing karpet di lantai satu satu persatu cari manual dan buka ini clue nya untuk menemukan kata kuncine`;
                typeWriter(text, 'mission2Text');
            } else if (missionNum === 3) {
                startMission3();
            } else if (missionNum === 4) {
                const text = `Harap semua orang yang berada di kawasan ini semuanya mengikuti aturan misi ini yaitu memutari sd mi selama 3menit dan setelah selesai dan balik langsung buka pengaturan wifi kalian dan lihat apa yang terjadi, di situ kami akan muncul secara digital karna kamu tidak dapat kalian lihat, di situ ada nama-nama game dan nama-nama anomali kami jadi harap jangan takut`;
                typeWriter(text, 'mission4Text');
            } else if (missionNum === 5) {
                const text = `Selanjutnya yaitu memakai handsaplas yang kami berikan sebelum nya di key tersembunyi yang kalian temui di misi sebelum nya pakai dan kalian bersembunyi dan berpencar masing2 karna di salah satu kalian ada yang kerasukan, tempel handsaplas itu ke salah satu anak terus bisa mengusir jin ghoib`;
                typeWriter(text, 'mission5Text');
            }
        }

        function checkClue() {
            const input = document.getElementById('clueInput').value.toUpperCase();
            if (input === 'SAT43') {
                document.getElementById('clueResult').innerHTML = '<p style="color: green;">BENAR! Kunci ditemukan...</p>';
                showLoading();
                setTimeout(() => {
                    hideLoading();
                    nextMission(3);
                }, 5000);
            } else {
                document.getElementById('clueResult').innerHTML = '<p style="color: red;">SALAH! Coba lagi...</p>';
            }
        }

        function startMission3() {
            const text = `Silahkan di antara kalian mundur 1 anak kami akan spin...`;
            typeWriter(text, 'mission3Text', () => {
                const players = JSON.parse(localStorage.getItem('players') || '[]');
                const container = document.getElementById('stepBackContainer');
                container.innerHTML = '';
                
                let spinCount = 0;
                const maxSpins = 8;
                
                const spinInterval = setInterval(() => {
                    const randomPlayer = players[Math.floor(Math.random() * players.length)];
                    container.innerHTML = `<div class="spin-item">${randomPlayer}</div>`;
                    
                    spinCount++;
                    if (spinCount >= maxSpins) {
                        clearInterval(spinInterval);
                        const finalPlayer = players[Math.floor(Math.random() * players.length)];
                        container.innerHTML = `<div class="spin-item" style="animation: none; opacity: 1; transform: scale(1.5);">${finalPlayer}</div>`;
                        
                        setTimeout(() => {
                            const resultText = `Langsung di antara orang lain yang di pilih satu harap mundur 5 meter dari perangkat hp salah satu anak yang di pilih yaitu ${finalPlayer}`;
                            typeWriter(resultText, 'mission3Text', () => {
                                document.getElementById('continueBtn3').style.display = 'block';
                            });
                        }, 1000);
                    }
                }, 300);
            });
        }

        function completeGame() {
            const text = `Misi yang anda kerjakan sudah selesai, pastikan jangan membuka ulang games horor ini karna kalau kalian tidak menyelesaikan misi kami akan datang dan menghantui kalian di jam 20.00 setiap hari Sabtu, minggu, kamis, Jumat`;
            typeWriter(text, 'storyText');
            
            // Clear all progress except completion
            localStorage.setItem('gameCompleted', 'true');
        }

        function deleteProgress() {
            if (confirm('Apakah Anda yakin ingin menghapus semua progress?')) {
                localStorage.clear();
                location.reload();
            }
        }

        function checkTime() {
            const now = new Date();
            const hour = now.getHours();
            const minute = now.getMinutes();
            
            // Check if it's 19:30
            if (hour === 19 && minute === 30) {
                showAlert();
            }
            // Check if it's 06:00
            else if (hour === 6 && minute === 0) {
                hideAlert();
            }
        }

        function showAlert() {
            const alertContainer = document.getElementById('alertContainer');
            const alertText = document.getElementById('alertText');
            const alertVideo = document.getElementById('alertVideo');
            
            alertContainer.classList.add('active');
            
            // Play alert sound
            playSound('https://youtu.be/flKtFnB4OVs?si=j_pkVH4Iz33M_HVJ');
            
            // Cycle through videos
            const videos = [
                'https://www.youtube.com/embed/8mcXpBb3VzU?autoplay=1&loop=1&playlist=8mcXpBb3VzU',
                'https://www.youtube.com/embed/JTcOy3bJ4p4?autoplay=1&loop=1&playlist=JTcOy3bJ4p4',
                'https://www.youtube.com/embed/Yz4Y61lZR_s?autoplay=1&loop=1&playlist=Yz4Y61lZR_s'
            ];
            
            let currentVideo = 0;
            alertVideo.src = videos[currentVideo];
            
            setInterval(() => {
                currentVideo = (currentVideo + 1) % videos.length;
                alertVideo.src = videos[currentVideo];
            }, 30000); // Change video every 30 seconds
            
            // Alert text
            const messages = [
                'BERSEMBUNYI CEPAT! Monster-monster yang kami tahan lepas kembali!',
                'Kami akan melakukan teror di kawasan ini!',
                'Pastikan anak-anak kecil di sekitar kalian telah memasuki rumah!',
                'Hallo saya disini, kami di dekat mu, kamu di mana?',
                'Kami mengawasi mu...',
                'Jangan tidur malam ini...'
            ];
            
            let messageIndex = 0;
            setInterval(() => {
                typeWriter(messages[messageIndex], 'alertText');
                messageIndex = (messageIndex + 1) % messages.length;
            }, 5000);
            
            // Send notifications
            if ('Notification' in window && Notification.permission === 'granted') {
                setInterval(() => {
                    new Notification('HAPPY DAY', {
                        body: messages[Math.floor(Math.random() * messages.length)],
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="50" font-size="50">👁️</text></svg>'
                    });
                }, 10000);
            }
            
            // Camera flash
            const flash = document.getElementById('cameraFlash');
            setInterval(() => {
                flash.style.animation = 'flash 0.5s';
                setTimeout(() => {
                    flash.style.animation = '';
                }, 500);
            }, 3000);
        }

        function hideAlert() {
            document.getElementById('alertContainer').classList.remove('active');
        }

        function updateCountdown() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentSecond = now.getSeconds();
            
            let targetHour, targetMinute;
            
            if (currentHour < 6 || currentHour >= 19) {
                // Next alert is at 19:30
                targetHour = 19;
                targetMinute = 30;
            } else {
                // Next alert is at 19:30
                targetHour = 19;
                targetMinute = 30;
            }
            
            let totalSeconds = ((targetHour - currentHour) * 3600) + ((targetMinute - currentMinute) * 60) - currentSecond;
            
            if (totalSeconds < 0) {
                totalSeconds += 24 * 3600; // Next day
            }
            
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            document.getElementById('countdown').textContent = 
                `Alert in: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function playSound(url) {
            const audio = new Audio(url);
            audio.play().catch(e => console.log('Audio play failed:', e));
        }

        function showLoading() {
            document.getElementById('loading').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        // Auto fullscreen
        function goFullscreen() {
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.webkitRequestFullscreen) {
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) {
                document.documentElement.msRequestFullscreen();
            }
        }

        // Add fullscreen button or auto-trigger
        document.addEventListener('click', function() {
            goFullscreen();
        }, { once: true });
    </script>
</body>
</html>
